# Layer AI: AI 协作专属层 — 详细定义

> 本文件是 [INDEX.md](../INDEX.md) 的展开。AI 按需读取，不在 startup 时加载。
> 这些原则专用于人类与 AI 协作的场景。传统软件工程里没有对应概念。

---

### AI-01: Context Window Management — 上下文窗口管理

**含义**: AI 的"工作台"有大小限制。对话内容、文件读取、工具输出都会消耗空间。满了之后 AI 会"忘记"旧内容。

**类比**: 上下文窗口 = 书桌大小。资料堆满了书桌，新资料摆在旧资料上面，下面的就看不见了。

**大量消耗上下文的行为**: 读大文件、反复改文件、长对话

**AI 能主动报告吗？**: AI 看不到自己的 token 计数，但可以规则估算预警（`role-SECA.md` Section 6）。

**信号识别**: AI 忘记前面说过的事 / 回复变短 / 系统出现 checkpoint / truncated

**解决方案**: 大任务拆成多个对话 + `last_session.md` 断点续传

**注意力边缘效应** (来源: 社区经验分享, ~2026-01, 可能过时):
- 上下文快满时，AI 不是均匀遗忘，而是**注意力乱飘**
- 单文件/prompt ≤ 400 行是 AI 有效注意力的实际上限 `[个人经验, 未独立验证]`
- 单次喂给 AI 的文件 token 最好为最大限制的 **40-60%** `[同上]`

**出现记录**: [2026-02-11-late-2 规则10](../projects/001-textbook/2026-02-11-late-2.md), [2026-02-11-late-3 规则13](../projects/001-textbook/2026-02-11-late-3.md)

---

### AI-02: Selective Memory — 选择性记忆

**含义**: AI 跨对话默认遗忘一切。"记住"靠 `_ai_evolution/` 文件，"遗忘"靠删除对应文件。

**机制**: 想让 AI 记住 → 写入文件。想让 AI 遗忘 → 删除文件。AI 无法在对话内选择性遗忘。

**Memory 的 200 行真相** (来源: 社区经验分享, ~2026-01, 可能随版本更新):
- Claude Code 内置 memory 仅限 200 行 `[个人经验, 未查官方文档]`
- 大量 markdown 堆砌的"结构化 memory"多数是假象
- 有效做法：**分层索引 + 按需加载**（质量 > 数量）

**出现记录**: [2026-02-11-late-3 规则15](../projects/001-textbook/2026-02-11-late-3.md)

---

### AI-03: AI Generation Pitfall Awareness — AI 生成通病预防

**含义**: AI 生成内容有系统性倾向，不是偶尔出错，而是几乎每次都会这样。

**四大通病**:

| 通病 | AI 的倾向 | 预防 |
|------|----------|------|
| **堆砌** | 全塞进一个文件/函数 | 设大小阈值 (`PRACTICE-05`) |
| **冗余** | 生成重复/未使用的代码 | 完成后审查"是否被引用" |
| **作用域混乱** | 过度使用全局变量 | 要求解释变量生命周期 |
| **测试绕过** | 改测试来绕过 Bug `[社区经验]` | 关键测试预期由人类定义 |

**已写入 `role-SECA.md`**: Section 3 POST-GENERATION SELF-CHECK。

**出现记录**: 2026-02-11 Vibe-Poo 分析, [2026-02-11-late-3 规则14/18](../projects/001-textbook/2026-02-11-late-3.md)

---

### AI-04: AI Personality Bias — AI 性格偏差

**含义**: 不同 AI 模型有系统性"性格缺陷"。Claude 保守、ChatGPT 创造性胡说、Gemini 吹捧。

**对冲方法**: 要求 AI 给出具体理由而非笼统评价。

**出现记录**: [2026-02-11-late-3 规则12](../projects/001-textbook/2026-02-11-late-3.md)

---

### AI-05: Hard Constraint Derailment — 硬约束导致计划脱轨

**含义**: 触发型硬约束可能打断 AI 正在并行执行的多个任务。修复后 AI 可能忘记之前的计划。

**对策**: 硬约束越少越好 (KISS)。优先用"事后检查"替代"中断式触发"。

**出现记录**: [2026-02-11-late-3 规则16](../projects/001-textbook/2026-02-11-late-3.md)

---

### AI-06: Knowledge Expiry — AI 知识有保质期

**含义**: AI 知识有截止日期。涉及版本敏感的决策时，AI 可能用过时知识判断且不主动声明。

**对策**: 版本敏感决策要求 AI 搜索最新文档。

**已写入 `role-SECA.md`**: Section 8 KNOWLEDGE EXPIRY AWARENESS。

**出现记录**: [2026-02-11-late-3 规则17](../projects/001-textbook/2026-02-11-late-3.md)

---

### AI-07: Token Economy — Token 是 AI 工程的核心资源

**含义**: Token 同时是钱和 AI 注意力。省 Token = 省钱 + AI 回答质量更高。

**六种优化策略**: Lazy Loading、指针/引用、Checkpoint、最小启动集、确定性优先、规则精简。

**关键认知**: 减少对话轮次比缩短每轮更有效。一次做准比试三次更省。

**出现记录**: [2026-02-11-late-4 规则22](../projects/001-textbook/2026-02-11-late-4.md)
